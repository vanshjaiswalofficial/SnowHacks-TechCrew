<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Employee Work System</title>
    <link rel="stylesheet" href="css/dashboard.css">
    <!-- FontAwesome for Icons (using CDN for demo) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>AdminPanel</h2>
            </div>
            <ul class="sidebar-menu">
                <li><a href="#" class="active" onclick="showSection('dashboard', this)"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                <li><a href="#" onclick="showSection('employees', this)"><i class="fas fa-users"></i> Employees</a></li>
                <li><a href="#" onclick="showSection('projects', this)"><i class="fas fa-briefcase"></i> Projects</a></li>
                <li><a href="#" onclick="showSection('transfer', this)"><i class="fas fa-exchange-alt"></i> Work Transfer</a>
                </li>
                <li><a href="#" onclick="showSection('logs', this)"><i class="fas fa-history"></i> Logs</a></li>
                <li><a href="#" onclick="showSection('permissions', this)"><i class="fas fa-lock"></i> Permissions</a></li>
                <li><a href="#" onclick="showSection('reports', this)"><i class="fas fa-chart-line"></i> Reports</a></li>
            </ul>
            <div class="sidebar-footer">
                <a href="index.html" class="text-danger"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <div class="page-header">
                <h1 id="pageTitle">Employee Management</h1>
                <div class="user-actions">
                    <div style="display:flex;align-items:center;gap:12px;">
                        <button class="btn btn-outline" onclick="openAddEmployeeModal()"><i class="fas fa-user-plus"></i> Add Employee</button>
                        <label class="btn btn-outline" style="cursor:pointer;">
                            <i class="fas fa-file-import"></i> <input id="csvInput" type="file" accept=".csv" style="display:none;" onchange="handleCSVImport(event)"> Import
                        </label>
                        <button class="btn btn-outline" onclick="exportEmployeesCSV()"><i class="fas fa-file-export"></i> Export</button>
                    </div>
                    <div style="display:flex;align-items:center;gap:12px;margin-left:16px;">
                        <div style="position:relative;">
                            <input id="employeeSearch" class="form-input" placeholder="Search employees..." style="padding:8px 12px; width:220px;" oninput="searchEmployees(this.value)">
                        </div>
                        <button id="themeToggle" class="btn btn-outline" onclick="toggleTheme()"><i class="fas fa-adjust"></i></button>
                        <button class="btn btn-outline" onclick="showNotifications()"><i class="fas fa-bell"></i></button>
                    </div>
                </div>
            </div>

            <!-- Dashboard Top-level -->
            <div id="dashboardSection" class="section">
                <div id="statsSection" class="transfer-grid mb-20" style="grid-template-columns: repeat(4, 1fr); margin-top: 0;">
                    <div class="card text-center">
                        <h3 class="text-muted">Total Employees</h3>
                        <p id="totalEmployeesCount" style="font-size: 1.5rem; margin-top: 10px;">0</p>
                    </div>
                    <div class="card text-center">
                        <h3 class="text-muted">Active Projects</h3>
                        <p id="activeProjectsCount" style="font-size: 1.5rem; margin-top: 10px;">0</p>
                    </div>
                    <div class="card text-center">
                        <h3 class="text-muted">Pending Tasks</h3>
                        <p id="pendingTasksCount" style="font-size: 1.5rem; margin-top: 10px;">0</p>
                    </div>
                    <div class="card text-center">
                        <h3 class="text-muted">Employees Left</h3>
                        <p id="employeesLeftCount" class="text-danger" style="font-size: 1.5rem; margin-top: 10px;">0</p>
                    </div>
                </div>

                <div class="card">
                    <div style="display:flex;justify-content:space-between;align-items:center;">
                        <h3>Recent Activity</h3>
                        <button class="btn btn-outline" onclick="loadLogs(); showSection('logs', document.querySelector('.sidebar-menu a[onclick*=logs]'))">View All</button>
                    </div>
                    <div id="recentActivity" style="margin-top:12px;">
                        <!-- Recent activity populated by JS -->
                    </div>
                </div>
            </div>

            <!-- Employee Management Section -->
            <div id="employeesSection" class="section">
                <div class="card">
                    <div class="flex justify-between items-center mb-20">
                        <h3>Employee List</h3>
                        <div style="display:flex;gap:8px;align-items:center;">
                            <small class="text-muted">Quick Actions</small>
                        </div>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Emp ID</th>
                                    <th>Name</th>
                                    <th>Role</th>
                                    <th>Project</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="employeeTableBody">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Add / Edit Employee Modal -->
            <div id="employeeModal" class="modal hidden">
                <div class="modal-backdrop" onclick="closeEmployeeModal()"></div>
                <div class="modal-card card">
                    <h3 id="employeeModalTitle">Add Employee</h3>
                    <div style="margin-top:12px;">
                        <input id="empName" class="form-input" placeholder="Full name">
                        <input id="empRole" class="form-input" placeholder="Role (e.g., Developer)">
                        <input id="empProject" class="form-input" placeholder="Project">
                        <select id="empStatus" class="form-select">
                            <option value="Active">Active</option>
                            <option value="Left">Left</option>
                        </select>
                        <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:8px;">
                            <button class="btn btn-outline" onclick="closeEmployeeModal()">Cancel</button>
                            <button class="btn btn-primary" onclick="saveEmployeeFromForm()">Save</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Toast container -->
            <div id="toastContainer" style="position:fixed;right:20px;bottom:20px;z-index:9999"></div>

            <!-- Work Transfer Section -->
            <div id="transferSection" class="section hidden">
                <div class="card">
                    <h3>Transfer Work</h3>
                    <p class="text-muted mb-20">Move tasks and files from a leaver to a new assignee.</p>

                    <div class="transfer-grid">
                        <div class="transfer-section">
                            <h4><i class="fas fa-user-minus"></i> From (Leaver)</h4>
                            <select id="leaverSelect" class="form-select" onchange="loadLeaverData()">
                                <option value="">Select Employee</option>
                                <!-- Populated by JS -->
                            </select>

                            <div id="leaverData" class="hidden mt-20">
                                <p><strong>Pending Tasks:</strong> <span id="pendingCount">0</span></p>
                                <p><strong>Files:</strong> <span id="fileCount">0</span></p>
                                <div class="badge badge-warning mt-10">Status: Leaving</div>
                            </div>
                        </div>

                        <div class="transfer-arrow">
                            <i class="fas fa-arrow-right"></i>
                        </div>

                        <div class="transfer-section">
                            <h4><i class="fas fa-user-plus"></i> To (Receiver)</h4>
                            <select id="receiverSelect" class="form-select">
                                <option value="">Select Employee</option>
                                <!-- Populated by JS -->
                            </select>

                            <div class="mt-20">
                                <button class="btn btn-primary w-100" onclick="handleTransfer()">
                                    Transfer All Work
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Projects Section -->
            <div id="projectsSection" class="section hidden">
                <div class="card">
                    <div class="flex justify-between items-center mb-20">
                        <h3>Active Projects</h3>
                        <button class="btn btn-primary" onclick="openCreateProjectModal()"><i class="fas fa-plus"></i> Create Project</button>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Project Name</th>
                                    <th>Timeline</th>
                                    <th>Team Size</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="projectsTableBody">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Create Project Modal -->
            <div id="projectModal" class="modal hidden">
                <div class="modal-backdrop" onclick="closeProjectModal()"></div>
                <div class="modal-card card">
                    <h3 id="projectModalTitle">Create Project</h3>
                    <div style="margin-top:12px;">
                        <input id="projName" class="form-input" placeholder="Project name">
                        <input id="projStart" class="form-input" type="date" placeholder="Start date">
                        <input id="projEnd" class="form-input" type="date" placeholder="End date">
                        <select id="projStatus" class="form-select">
                            <option value="Active">Active</option>
                            <option value="Completed">Completed</option>
                        </select>
                        <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:8px;">
                            <button class="btn btn-outline" onclick="closeProjectModal()">Cancel</button>
                            <button class="btn btn-primary" onclick="saveProjectFromForm()">Save</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Assign Employees Modal -->
            <div id="assignModal" class="modal hidden">
                <div class="modal-backdrop" onclick="closeAssignModal()"></div>
                <div class="modal-card card">
                    <h3 id="assignModalTitle">Assign Employees</h3>
                    <div style="margin-top:12px;">
                        <div id="assignEmployeesList" style="display:grid;grid-template-columns:1fr 1fr;gap:8px;max-height:260px;overflow:auto;"></div>
                        <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:8px;">
                            <button class="btn btn-outline" onclick="closeAssignModal()">Cancel</button>
                            <button class="btn btn-primary" onclick="saveProjectAssignment()">Assign</button>
                        </div>
                    </div>
                </div>

                        <!-- Create Task Modal -->
                        <div id="taskModal" class="modal hidden">
                            <div class="modal-backdrop" onclick="closeTaskModal()"></div>
                            <div class="modal-card card">
                                <h3 id="taskModalTitle">Create Task</h3>
                                <div style="margin-top:12px;">
                                    <input id="taskName" class="form-input" placeholder="Task title">
                                    <select id="taskAssign" class="form-select">
                                        <option value="">Unassigned</option>
                                    </select>
                                    <select id="taskProjectSelect" class="form-select">
                                        <option value="">Select Project</option>
                                    </select>
                                    <input id="taskDue" class="form-input" type="date">
                                    <select id="taskStatusSelect" class="form-select">
                                        <option value="Pending">Pending</option>
                                        <option value="In Progress">In Progress</option>
                                        <option value="Completed">Completed</option>
                                    </select>
                                    <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:8px;">
                                        <button class="btn btn-outline" onclick="closeTaskModal()">Cancel</button>
                                        <button class="btn btn-primary" onclick="saveTaskFromForm()">Save Task</button>
                                    </div>
                                </div>
                            </div>
                        </div>
            </div>

            <!-- Tasks / Work Overview -->
            <div id="tasksSection" class="section hidden">
                <div class="card">
                    <div style="display:flex;justify-content:space-between;align-items:center;">
                        <h3>Tasks & Work Overview</h3>
                        <div style="display:flex;gap:8px;align-items:center;">
                            <select id="taskFilterProject" class="form-select" onchange="loadTasks()">
                                <option value="">All Projects</option>
                            </select>
                            <select id="taskFilterStatus" class="form-select" onchange="loadTasks()">
                                <option value="">All Status</option>
                                <option value="Pending">Pending</option>
                                <option value="In Progress">In Progress</option>
                                <option value="Completed">Completed</option>
                            </select>
                            <input id="taskStartDate" class="form-input" type="date" onchange="loadTasks()" title="Start due date">
                            <input id="taskEndDate" class="form-input" type="date" onchange="loadTasks()" title="End due date">
                            <button class="btn btn-primary" onclick="openCreateTaskModal()"><i class="fas fa-plus"></i> Create Task</button>
                        </div>
                    </div>
                    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:12px;">
                        <div class="card text-center"><h4 class="text-muted">Total Tasks</h4><div id="totalTasksCount" style="font-size:1.25rem;margin-top:6px;">0</div></div>
                        <div class="card text-center"><h4 class="text-muted">Completed</h4><div id="completedTasksCount" style="font-size:1.25rem;margin-top:6px;">0</div></div>
                        <div class="card text-center"><h4 class="text-muted">Pending</h4><div id="pendingTasksCountOverview" style="font-size:1.25rem;margin-top:6px;">0</div></div>
                    </div>
                    <div class="table-container" style="margin-top:12px;">
                        <table>
                            <thead>
                                <tr><th>Task</th><th>Assigned To</th><th>Status</th><th>Due</th><th>Project</th><th>Actions</th></tr>
                            </thead>
                            <tbody id="tasksTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Logs Section -->
            <div id="logsSection" class="section hidden">
                <div class="card">
                    <h3>System Activity Logs</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>User</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="logsTableBody">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Reports Section -->
            <div id="reportsSection" class="section hidden">
                <div class="card">
                    <div style="display:flex;justify-content:space-between;align-items:center;">
                        <h3>Reports & Analytics</h3>
                        <div style="display:flex;gap:8px;align-items:center;">
                            <label style="display:flex;gap:6px;align-items:center;color:var(--muted)">From <input id="reportStartDate" type="date" class="form-input" onchange="loadReports()" style="width:150px;margin-left:6px"></label>
                            <label style="display:flex;gap:6px;align-items:center;color:var(--muted)">To <input id="reportEndDate" type="date" class="form-input" onchange="loadReports()" style="width:150px;margin-left:6px"></label>
                            <button class="btn btn-outline" onclick="exportReportsCSV()"><i class="fas fa-file-export"></i> Export Report</button>
                        </div>
                    </div>

                    <div style="display:grid;grid-template-columns:1fr 420px;gap:18px;margin-top:12px;">
                        <div>
                            <div class="card">
                                <h4>Workload per Employee</h4>
                                <div id="workloadChart" style="margin-top:10px;"></div>
                            </div>

                            <div class="card" style="margin-top:12px;">
                                <h4>Overdue Tasks</h4>
                                <div id="overdueList" style="margin-top:8px;"></div>
                            </div>
                        </div>

                        <div>
                            <div class="card">
                                <h4>Active Projects Summary</h4>
                                <div id="projectsSummary" style="margin-top:8px;"></div>
                            </div>

                            <div class="card" style="margin-top:12px;">
                                <h4>Top N Employees (by tasks)</h4>
                                <div id="topEmployees" style="margin-top:8px;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Employee Profile Section -->
            <div id="profileSection" class="section hidden">
                <div class="card">
                    <div style="display:flex;justify-content:space-between;align-items:center;">
                        <div>
                            <h3 id="profileName">Employee Name</h3>
                            <div class="text-muted" id="profileMeta">Role · Project · Status</div>
                        </div>
                        <div style="display:flex;gap:8px;">
                            <button class="btn btn-outline" onclick="showSection('employees', document.querySelector('.sidebar-menu a[onclick*=employees]'))">Back</button>
                            <button class="btn btn-primary" id="profileEditBtn" onclick="alert('Edit profile - coming soon')">Edit</button>
                        </div>
                    </div>

                    <div style="display:grid;grid-template-columns:1fr 320px;gap:18px;margin-top:16px;">
                        <div>
                            <div class="card">
                                <h4>Tasks</h4>
                                <div class="table-container" style="margin-top:8px;">
                                    <table>
                                        <thead>
                                            <tr><th>Task</th><th>Status</th><th>Due</th></tr>
                                        </thead>
                                        <tbody id="profileTasksBody"></tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="card" style="margin-top:12px;">
                                <h4>Timeline</h4>
                                <div id="profileTimeline" class="timeline" style="margin-top:8px;"></div>
                            </div>
                        </div>

                        <div>
                            <div class="card">
                                <h4>Files</h4>
                                <div id="profileFiles" style="margin-top:8px;"></div>
                                <input id="attachFileInput" type="file" style="margin-top:10px;" onchange="attachFileToEmployee(event)">
                            </div>

                            <div class="card" style="margin-top:12px;">
                                <h4>Notes</h4>
                                <textarea id="profileNotes" class="form-input" rows="6" placeholder="Add notes about this employee..."></textarea>
                                <div style="display:flex;justify-content:flex-end;margin-top:8px;"><button class="btn btn-primary" onclick="saveProfileNotes()">Save Note</button></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Permissions Section -->
            <div id="permissionsSection" class="section hidden">
                <div class="card">
                    <h3>Permissions & Role Settings</h3>
                    <p class="text-muted">Grant or revoke feature permissions per role.</p>
                    <div style="display:flex;gap:20px;margin-top:12px;align-items:flex-start;">
                        <div style="min-width:180px;">
                            <h4>Roles</h4>
                            <ul id="rolesList">
                                <li><button class="btn btn-outline" onclick="selectRole('Admin')">Admin</button></li>
                                <li style="margin-top:6px;"><button class="btn btn-outline" onclick="selectRole('Manager')">Manager</button></li>
                                <li style="margin-top:6px;"><button class="btn btn-outline" onclick="selectRole('Employee')">Employee</button></li>
                            </ul>
                        </div>
                        <div style="flex:1;">
                            <h4 id="roleTitle">Permissions for: Admin</h4>
                            <div id="permissionsForm" style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px;">
                                <!-- checkboxes inserted by JS -->
                            </div>
                            <div style="display:flex;justify-content:flex-end;margin-top:10px;">
                                <button class="btn btn-outline" onclick="loadPermissions()">Reset</button>
                                <button class="btn btn-primary" style="margin-left:8px;" onclick="savePermissionsForRole()">Save</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script src="js/data.js"></script>
    <script src="js/api.js"></script>
    <script src="js/admin.js"></script>
</body>

</html>