<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Employee Work System</title>
    <link rel="stylesheet" href="css/dashboard.css">
    <!-- FontAwesome for Icons (using CDN for demo) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>AdminPanel</h2>
            </div>
            <ul class="sidebar-menu">
                <li><a href="#" onclick="showSection('dashboard', this)"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                <li><a href="#" onclick="showSection('employees', this)"><i class="fas fa-users"></i> Employees</a></li>
                <li><a href="#" onclick="showSection('users', this)"><i class="fas fa-user-cog"></i> Users</a></li>
                <li><a href="#" onclick="showSection('projects', this)"><i class="fas fa-briefcase"></i> Projects</a></li>
                <li><a href="#" onclick="showSection('transfer', this)"><i class="fas fa-exchange-alt"></i> Work Transfer</a>
                </li>
                <li><a href="#" onclick="showSection('logs', this)"><i class="fas fa-history"></i> Logs</a></li>
                <li><a href="#" onclick="showSection('permissions', this)"><i class="fas fa-lock"></i> Permissions</a></li>
                <li><a href="#" onclick="showSection('reports', this)"><i class="fas fa-chart-line"></i> Reports</a></li>
            </ul>
            <div class="sidebar-footer">
                <a href="index.html" class="text-danger"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <div class="page-header">
                <h1 id="pageTitle">Employee Management</h1>
                <div class="user-actions">
                    <div class="row-center-gap">
                        <button class="btn btn-outline" onclick="openAddEmployeeModal()"><i class="fas fa-user-plus"></i> Add Employee</button>
                        <label class="btn btn-outline">
                            <i class="fas fa-file-import"></i> <input id="csvInput" type="file" accept=".csv" class="hidden" onchange="handleCSVImport(event)"> Import
                        </label>
                        <button class="btn btn-outline" onclick="exportEmployeesCSV()"><i class="fas fa-file-export"></i> Export</button>
                    </div>
                    <div class="row-center-gap ml-16">
                        <div class="relative">
                            <input id="employeeSearch" class="form-input search-input" placeholder="Search employees..." oninput="searchEmployees(this.value)" title="Search employees">
                        </div>
                        <button id="themeToggle" class="btn btn-outline" onclick="toggleTheme()" title="Toggle theme"><i class="fas fa-adjust"></i></button>
                        <button class="btn btn-outline" onclick="showNotifications()" title="Notifications"><i class="fas fa-bell"></i></button>
                    </div>
                </div>
            </div>

            <!-- Dashboard Top-level -->
            <div id="dashboardSection" class="section hidden">
                <div id="statsSection" class="transfer-grid mb-20">
                    <div class="card text-center">
                        <h3 class="text-muted">Total Employees</h3>
                        <p id="totalEmployeesCount" class="stats-value">0</p>
                    </div>
                    <div class="card text-center">
                        <h3 class="text-muted">Active Projects</h3>
                        <p id="activeProjectsCount" class="stats-value">0</p>
                    </div>
                    <div class="card text-center">
                        <h3 class="text-muted">Pending Tasks</h3>
                        <p id="pendingTasksCount" class="stats-value">0</p>
                    </div>
                    <div class="card text-center">
                        <h3 class="text-muted">Employees Left</h3>
                        <p id="employeesLeftCount" class="text-danger stats-value">0</p>
                    </div>
                </div>

                    <div class="card">
                    <div class="space-between-center">
                        <h3>Recent Activity</h3>
                        <button class="btn btn-outline" onclick="loadLogs(); showSection('logs', document.querySelector('.sidebar-menu a[onclick*=logs]'))">View All</button>
                    </div>
                    <div id="recentActivity" class="mt-12">
                        <!-- Recent activity populated by JS -->
                    </div>
                </div>
            </div>

            <!-- Employee Management Section -->
            <div id="employeesSection" class="section hidden">
                    <div class="card">
                    <div class="flex justify-between items-center mb-20">
                            <h3>Employee List</h3>
                        <div class="row-center-gap">
                            <small class="text-muted">Quick Actions</small>
                        </div>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Emp ID</th>
                                    <th>Name</th>
                                    <th>Role</th>
                                    <th>Project</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="employeeTableBody">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Add / Edit Employee Modal -->
            <div id="employeeModal" class="modal hidden">
                <div class="modal-backdrop" onclick="closeEmployeeModal()"></div>
                <div class="modal-card card">
                    <h3 id="employeeModalTitle">Add Employee</h3>
                    <div class="mt-12">
                        <input id="empName" class="form-input" placeholder="Full name">
                        <input id="empRole" class="form-input" placeholder="Role (e.g., Developer)">
                        <input id="empProject" class="form-input" placeholder="Project">
                        <input id="empEmail" class="form-input" placeholder="Email (login)">
                        <input id="empPassword" class="form-input" placeholder="Password (demo only)">
                        <label style="display:flex;align-items:center;gap:8px;margin-top:6px;"><input id="empIsAdmin" type="checkbox"> Make Admin</label>
                        <select id="empStatus" class="form-select" title="Employee status">
                            <option value="Active">Active</option>
                            <option value="Left">Left</option>
                        </select>
                        <div class="flex-end-gap">
                            <button class="btn btn-outline" onclick="closeEmployeeModal()">Cancel</button>
                            <button class="btn btn-primary" onclick="saveEmployeeFromForm()">Save</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Toast container -->
            <div id="toastContainer" class="toast-container"></div>

            <!-- Work Transfer Section -->
            <div id="transferSection" class="section hidden">
                <div class="card">
                    <h3>Transfer Work</h3>
                    <p class="text-muted mb-20">Move tasks and files from a leaver to a new assignee.</p>

                    <div class="transfer-grid">
                        <div class="transfer-section">
                            <h4><i class="fas fa-user-minus"></i> From (Leaver)</h4>
                            <select id="leaverSelect" class="form-select" onchange="loadLeaverData()" title="Select leaver">
                                <option value="">Select Employee</option>
                                <!-- Populated by JS -->
                            </select>

                            <div id="leaverData" class="hidden mt-20">
                                <p><strong>Pending Tasks:</strong> <span id="pendingCount">0</span></p>
                                <p><strong>Files:</strong> <span id="fileCount">0</span></p>
                                <div class="badge badge-warning mt-10">Status: Leaving</div>
                            </div>
                        </div>

                        <div class="transfer-arrow">
                            <i class="fas fa-arrow-right"></i>
                        </div>

                        <div class="transfer-section">
                            <h4><i class="fas fa-user-plus"></i> To (Receiver)</h4>
                            <select id="receiverSelect" class="form-select" title="Select receiver">
                                <option value="">Select Employee</option>
                                <!-- Populated by JS -->
                            </select>

                            <div class="mt-20">
                                <button class="btn btn-primary w-100" onclick="handleTransfer()">
                                    Transfer All Work
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Projects Section -->
            <div id="projectsSection" class="section hidden">
                <div class="card">
                    <div class="flex justify-between items-center mb-20">
                        <h3>Active Projects</h3>
                        <button class="btn btn-primary" onclick="openCreateProjectModal()"><i class="fas fa-plus"></i> Create Project</button>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Project Name</th>
                                    <th>Timeline</th>
                                    <th>Team Size</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="projectsTableBody">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Create Project Modal -->
            <div id="projectModal" class="modal hidden">
                <div class="modal-backdrop" onclick="closeProjectModal()"></div>
                        <div class="modal-card card">
                        <h3 id="projectModalTitle">Create Project</h3>
                    <div class="mt-12">
                        <input id="projName" class="form-input" placeholder="Project name">
                        <input id="projStart" class="form-input" type="date" placeholder="Start date">
                        <input id="projEnd" class="form-input" type="date" placeholder="End date">
                        <select id="projStatus" class="form-select" title="Project status">
                            <option value="Active">Active</option>
                            <option value="Completed">Completed</option>
                        </select>
                        <div class="flex-end-gap">
                            <button class="btn btn-outline" onclick="closeProjectModal()">Cancel</button>
                            <button class="btn btn-primary" onclick="saveProjectFromForm()">Save</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Assign Employees Modal -->
                    <div id="assignModal" class="modal hidden">
                <div class="modal-backdrop" onclick="closeAssignModal()"></div>
                <div class="modal-card card">
                    <h3 id="assignModalTitle">Assign Employees</h3>
                    <div class="mt-12">
                        <div id="assignEmployeesList" class="assignEmployeesList"></div>
                        <div class="flex-end-gap">
                            <button class="btn btn-outline" onclick="closeAssignModal()">Cancel</button>
                            <button class="btn btn-primary" onclick="saveProjectAssignment()">Assign</button>
                        </div>
                    </div>
                </div>

                        <!-- Create Task Modal -->
                        <div id="taskModal" class="modal hidden">
                            <div class="modal-backdrop" onclick="closeTaskModal()"></div>
                            <div class="modal-card card">
                                <h3 id="taskModalTitle">Create Task</h3>
                                <div class="mt-12">
                                    <input id="taskName" class="form-input" placeholder="Task title">
                                    <select id="taskAssign" class="form-select" title="Assign task to">
                                        <option value="">Unassigned</option>
                                    </select>
                                    <select id="taskProjectSelect" class="form-select" title="Select project">
                                        <option value="">Select Project</option>
                                    </select>
                                    <input id="taskDue" class="form-input" type="date" title="Task due date">
                                    <select id="taskStatusSelect" class="form-select" title="Task status">
                                        <option value="Pending">Pending</option>
                                        <option value="In Progress">In Progress</option>
                                        <option value="Completed">Completed</option>
                                    </select>
                                    <div class="flex-end-gap">
                                        <button class="btn btn-outline" onclick="closeTaskModal()">Cancel</button>
                                        <button class="btn btn-primary" onclick="saveTaskFromForm()">Save Task</button>
                                    </div>
                                </div>
                            </div>
                        </div>
            </div>

            <!-- Tasks / Work Overview -->
            <div id="tasksSection" class="section hidden">
                <div class="card">
                    <div class="space-between-center">
                        <h3>Tasks & Work Overview</h3>
                        <div class="row-center-gap">
                            <select id="taskFilterProject" class="form-select" onchange="loadTasks()" title="Filter by project">
                                <option value="">All Projects</option>
                            </select>
                            <select id="taskFilterStatus" class="form-select" onchange="loadTasks()" title="Filter by status">
                                <option value="">All Status</option>
                                <option value="Pending">Pending</option>
                                <option value="In Progress">In Progress</option>
                                <option value="Completed">Completed</option>
                            </select>
                            <input id="taskStartDate" class="form-input" type="date" onchange="loadTasks()" title="Start due date">
                            <input id="taskEndDate" class="form-input" type="date" onchange="loadTasks()" title="End due date">
                            <button class="btn btn-primary" onclick="openCreateTaskModal()"><i class="fas fa-plus"></i> Create Task</button>
                        </div>
                    </div>
                    <div class="grid-3">
                        <div class="card text-center"><h4 class="text-muted">Total Tasks</h4><div id="totalTasksCount" class="stat-small">0</div></div>
                        <div class="card text-center"><h4 class="text-muted">Completed</h4><div id="completedTasksCount" class="stat-small">0</div></div>
                        <div class="card text-center"><h4 class="text-muted">Pending</h4><div id="pendingTasksCountOverview" class="stat-small">0</div></div>
                    </div>
                    <div class="table-container mt-12">
                        <table>
                            <thead>
                                <tr><th>Task</th><th>Assigned To</th><th>Status</th><th>Due</th><th>Project</th><th>Actions</th></tr>
                            </thead>
                            <tbody id="tasksTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Logs Section -->
            <div id="logsSection" class="section hidden">
                <div class="card">
                    <h3>System Activity Logs</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>User</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="logsTableBody">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Reports Section -->
            <div id="reportsSection" class="section hidden">
                <div class="card">
                    <div class="space-between-center">
                        <h3>Reports & Analytics</h3>
                        <div class="row-center-gap">
                            <label class="label-inline">From <input id="reportStartDate" type="date" class="form-input date-input" onchange="loadReports()" title="Report start date"></label>
                            <label class="label-inline">To <input id="reportEndDate" type="date" class="form-input date-input" onchange="loadReports()" title="Report end date"></label>
                            <button class="btn btn-outline" onclick="exportReportsCSV()"><i class="fas fa-file-export"></i> Export Report</button>
                        </div>
                    </div>
                    <div class="grid-1-420">
                        <div>
                            <div class="card">
                                <h4>Workload per Employee</h4>
                                <div id="workloadChart" class="wk-margin-top"></div>
                            </div>

                            <div class="card card-mt12">
                                <h4>Overdue Tasks</h4>
                                <div id="overdueList" class="profile-mt8"></div>
                            </div>
                        </div>

                        <div>
                            <div class="card">
                                <h4>Active Projects Summary</h4>
                                <div id="projectsSummary" class="profile-mt8"></div>
                            </div>

                            <div class="card card-mt12">
                                <h4>Top N Employees (by tasks)</h4>
                                <div id="topEmployees" class="profile-mt8"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Employee Profile Section -->
            <div id="profileSection" class="section hidden">
                <div class="card">
                    <div class="space-between-center">
                        <div>
                            <h3 id="profileName">Employee Name</h3>
                            <div class="text-muted" id="profileMeta">Role · Project · Status</div>
                        </div>
                        <div class="row-center-gap">
                                <button class="btn btn-outline" onclick="showSection('employees', document.querySelector('.sidebar-menu a[onclick*=employees]'))">Back</button>
                                <button class="btn btn-primary" id="profileEditBtn" onclick="alert('Edit profile - coming soon')">Edit</button>
                            </div>
                    </div>

                        <div class="grid-1-320">
                        <div>
                            <div class="card">
                                <h4>Tasks</h4>
                                    <div class="table-container profile-mt8">
                                    <table>
                                        <thead>
                                            <tr><th>Task</th><th>Status</th><th>Due</th></tr>
                                        </thead>
                                        <tbody id="profileTasksBody"></tbody>
                                    </table>
                                </div>
                            </div>

                                <div class="card card-mt12">
                                <h4>Timeline</h4>
                                    <div id="profileTimeline" class="timeline profile-mt8"></div>
                            </div>
                        </div>

                        <div>
                            <div class="card">
                                <h4>Files</h4>
                                    <div id="profileFiles" class="profile-mt8"></div>
                                    <input id="attachFileInput" type="file" class="profile-mt8" title="Attach file" onchange="attachFileToEmployee(event)">
                            </div>

                                <div class="card card-mt12">
                                <h4>Notes</h4>
                                <textarea id="profileNotes" class="form-input" rows="6" placeholder="Add notes about this employee..."></textarea>
                                    <div class="flex-end-gap"><button class="btn btn-primary" onclick="saveProfileNotes()">Save Note</button></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Permissions Section -->
            <div id="permissionsSection" class="section hidden">
                <div class="card">
                    <h3>Permissions & Role Settings</h3>
                    <p class="text-muted">Grant or revoke feature permissions per role.</p>
                    <div class="row-gap-20">
                        <div class="min-width-180">
                            <h4>Roles</h4>
                            <ul id="rolesList">
                                <li><button class="btn btn-outline" onclick="selectRole('Admin')">Admin</button></li>
                                <li class="mt-6"><button class="btn btn-outline" onclick="selectRole('Manager')">Manager</button></li>
                                <li class="mt-6"><button class="btn btn-outline" onclick="selectRole('Employee')">Employee</button></li>
                            </ul>
                        </div>
                        <div class="flex-fill">
                            <h4 id="roleTitle">Permissions for: Admin</h4>
                            <div id="permissionsForm" class="permissions-grid">
                                <!-- checkboxes inserted by JS -->
                            </div>
                            <div class="flex-end-gap mt-10">
                                <button class="btn btn-outline" onclick="loadPermissions()">Reset</button>
                                <button class="btn btn-primary ml-8" onclick="savePermissionsForRole()">Save</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script src="js/data.js"></script>
    <script src="js/api.js"></script>
    <script src="js/admin.js"></script>
</body>

</html>